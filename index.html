<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'">
    <title>Sea Monkey Farm</title>
    <style>
      * { box-sizing: border-box; margin: 0; padding: 0; }

      /* ── GLOBAL SCROLLBARS ── */
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: #050f1e; }
      ::-webkit-scrollbar-thumb { background: #1a5f8a; border-radius: 3px; }
      ::-webkit-scrollbar-thumb:hover { background: #2a7fbf; }
      ::-webkit-scrollbar-corner { background: #050f1e; }

      body {
        width: 100vw; height: 100vh; overflow: hidden;
        font-family: 'Segoe UI', system-ui, sans-serif;
        font-size: 12px;
        background: #0a1628;
        color: #cce4ff;
        display: grid;
        grid-template-areas: "header header" "sidebar tank" "sidebar statusbar";
        grid-template-columns: 280px 1fr;
        transition: grid-template-columns 0.2s ease;
        grid-template-rows: 50px 1fr 30px;
      }

      /* ── HEADER ── */
      #header {
        grid-area: header;
        background: linear-gradient(90deg, #0d2137, #0a3a5c);
        border-bottom: 2px solid #1a5f8a;
        display: flex; align-items: center;
        padding: 0 16px; gap: 20px;
      }
      #header h1 { font-size: 18px; color: #7fd8ff; letter-spacing: 1px; white-space: nowrap; }
      .header-census { display: flex; gap: 20px; margin: 0 auto; font-size: 11px; }
      .header-stats { display: flex; gap: 16px; font-size: 11px; }
      #btn-settings {
        background: none; border: 1px solid #1a3a5c; border-radius: 6px;
        color: #5599bb; font-size: 18px; width: 36px; height: 36px;
        cursor: pointer; display: flex; align-items: center; justify-content: center;
        transition: background 0.15s, color 0.15s; flex-shrink: 0;
      }
      #btn-settings:hover { background: #0d2137; color: #7fd8ff; }
      #btn-pause { background: none; border: 1px solid #1a3a5c; border-radius: 6px; color: #5599bb; font-size: 18px; width: 36px; height: 36px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.15s, color 0.15s, border-color 0.15s; flex-shrink: 0; }
      #btn-pause:hover { background: #0d2137; color: #7fd8ff; }
      #btn-pause.paused { border-color: #aa5500; color: #ffaa44; background: #2a1500; }
      #btn-pause.paused:hover { background: #3a2000; }

      /* Settings popup */
      #settings-overlay {
        position: fixed; inset: 0; z-index: 100;
        display: none;
      }
      #settings-overlay.open { display: block; }
      #settings-popup {
        position: fixed; top: 56px; right: 12px;
        background: #0d2137; border: 1px solid #1a5f8a;
        border-radius: 8px; padding: 14px; width: 260px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.6);
        display: flex; flex-direction: column; gap: 10px;
      }
      .settings-title {
        font-size: 12px; font-weight: bold; color: #7fd8ff;
        border-bottom: 1px solid #1a3a5c; padding-bottom: 8px;
      }
      .settings-section { display: flex; flex-direction: column; gap: 6px; }
      .settings-section + .settings-section { border-top: 1px solid #1a3a5c; padding-top: 8px; }
      .settings-row {
        display: flex; align-items: center; justify-content: space-between; gap: 8px;
        font-size: 11px; color: #88bbcc;
      }
      .toggle-switch { position: relative; display: inline-block; width: 36px; height: 20px; flex-shrink: 0; }
      .toggle-switch input { opacity: 0; width: 0; height: 0; }
      .toggle-slider {
        position: absolute; cursor: pointer; inset: 0;
        background: #1a3a5c; border-radius: 20px; transition: background 0.2s;
      }
      .toggle-slider:before {
        position: absolute; content: '';
        width: 14px; height: 14px; left: 3px; bottom: 3px;
        background: #5599bb; border-radius: 50%; transition: transform 0.2s, background 0.2s;
      }
      .toggle-switch input:checked + .toggle-slider { background: #0a5a8c; }
      .toggle-switch input:checked + .toggle-slider:before { transform: translateX(16px); background: #7fd8ff; }

      .hstat { display: flex; flex-direction: column; align-items: center; }
      .hstat-label { color: #5599bb; font-size: 9px; text-transform: uppercase; letter-spacing: 1px; }
      .hstat-value { color: #7fd8ff; font-weight: bold; font-size: 14px; }
      .stat-row { display: flex; justify-content: space-between; padding: 2px 0; font-size: 12px; }
      .stat-label { color: #5599bb; }
      .stat-value { color: #7fd8ff; font-weight: bold; }

      /* ── SIDEBAR ── */
      #sidebar {
        grid-area: sidebar;
        background: #071424;
        border-right: 2px solid #1a3a5c;
        overflow-y: auto; overflow-x: hidden;
        padding: 8px;
        display: flex; flex-direction: column; gap: 8px;
        transition: padding 0.2s ease;
      }
      #sidebar-collapse-btn {
        background: none; border: 1px solid #1a3a5c; border-radius: 6px;
        color: #5599bb; font-size: 15px; width: 36px; height: 36px;
        cursor: pointer; display: flex; align-items: center; justify-content: center;
        transition: background 0.15s, color 0.15s; flex-shrink: 0;
      }
      #sidebar-collapse-btn:hover { background: #0d2137; color: #7fd8ff; }

      /* Mini sidebar (collapsed) */
      body.sidebar-mini {
        grid-template-columns: 44px 1fr;
      }
      body.sidebar-mini #sidebar {
        padding: 6px 4px;
        align-items: center;
        overflow: visible;
      }
      body.sidebar-mini .panel { display: none !important; }
      #sidebar-mini-content { display: none; flex-direction: column; align-items: center; gap: 5px; width: 100%; }
      body.sidebar-mini #sidebar-mini-content { display: flex; }
      #mini-lv-label { font-size: 8px; color: #5599bb; text-transform: uppercase; letter-spacing: 1px; }
      #mini-lv-num   { font-size: 17px; font-weight: bold; color: #ffd700; text-shadow: 0 0 6px rgba(255,215,0,0.4); text-align: center; margin-top: -2px; }
      #mini-conditions { display: flex; flex-direction: column; align-items: center; gap: 0; width: 100%; }
      .mini-tank-group { display: flex; flex-direction: column; align-items: center; gap: 2px; width: 100%; padding: 4px 0; }
      .mini-tank-group + .mini-tank-group { border-top: 1px solid #0a1a2c; }
      .mini-tank-label { font-size: 8px; color: #5599bb; text-transform: uppercase; letter-spacing: 0.5px; }
      .mini-tank-group.mini-active .mini-tank-label { color: #7fd8ff; }
      .mini-ring {
        width: 32px; height: 32px; border-radius: 50%;
        background: conic-gradient(from -90deg, var(--ring-color) calc(var(--pct,0) * 1%), #0a1628 0);
        display: flex; align-items: center; justify-content: center;
        position: relative; cursor: pointer; transition: opacity 0.15s;
      }
      .mini-ring::before {
        content: ''; position: absolute; inset: 5px;
        background: #071424; border-radius: 50%;
      }
      .mini-ring span { position: relative; z-index: 1; font-size: 12px; line-height: 1; }
      .mini-ring.food    { --ring-color: #ffdd00; }
      .mini-ring.oxygen  { --ring-color: #44aaff; }
      .mini-ring.clean   { --ring-color: #44cc77; }
      .mini-ring.danger  { --ring-color: #ff4444; animation: gauge-pulse 0.8s ease-in-out infinite; }
      .mini-ring.mini-disabled { opacity: 0.3; cursor: not-allowed; pointer-events: none; }
      .mini-ring:not(.mini-disabled):hover { filter: brightness(1.25); }

      .panel {
        background: #0d2137;
        border: 1px solid #1a3a5c;
        border-radius: 6px;
        padding: 8px;
      }
      .panel-title {
        font-size: 10px; text-transform: uppercase; letter-spacing: 1px;
        color: #5599bb; margin-bottom: 6px; border-bottom: 1px solid #1a3a5c;
        padding-bottom: 4px;
      }

      /* Tank Level panel */
      #tank-level-panel { display: flex; align-items: center; gap: 10px; }
      #tank-level-badge {
        font-size: 22px; font-weight: bold; color: #ffd700;
        text-shadow: 0 0 8px rgba(255,215,0,0.5);
        min-width: 32px; text-align: center; flex-shrink: 0;
      }
      #tank-level-badge span { font-size: 10px; display: block; color: #88bbcc; font-weight: normal; }
      #tank-xp-wrap { flex: 1; }
      #tank-xp-track {
        height: 8px; background: #0a1628; border-radius: 4px;
        border: 1px solid #1a3a5c; overflow: hidden; margin-top: 4px;
      }
      #tank-xp-bar {
        height: 100%; border-radius: 4px;
        background: linear-gradient(90deg, #b8860b, #ffd700);
        transition: width 0.5s ease;
      }
      #tank-xp-label { font-size: 9px; color: #5599bb; margin-top: 2px; }

      /* Gauges */
      .gauge { margin-bottom: 6px; }
      .gauge-label { display: flex; justify-content: space-between; margin-bottom: 2px; font-size: 10px; }
      .gauge-track {
        height: 8px; background: #0a1628; border-radius: 4px;
        border: 1px solid #1a3a5c; overflow: hidden;
      }
      .gauge-fill {
        height: 100%; border-radius: 4px; transition: width 0.5s ease;
      }
      .gauge-fill.food   { background: linear-gradient(90deg, #c8a000, #ffdd00); }
      .gauge-fill.oxygen { background: linear-gradient(90deg, #0055cc, #44aaff); }
      .gauge-fill.clean  { background: linear-gradient(90deg, #007733, #44cc77); }
      .gauge-fill.danger { animation: gauge-pulse 0.8s ease-in-out infinite; }

      #event-log-panel { display: flex; }

      /* ── TANK CONDITION RINGS ── */
      .tank-cond-row {
        display: flex; align-items: center; justify-content: space-between;
        padding: 4px 0; cursor: pointer;
      }
      .tank-cond-row + .tank-cond-row { border-top: 1px solid #0a1a2c; }
      .tank-row-flash { animation: tank-death-flash 2s ease-out forwards; border-radius: 4px; }
      @keyframes tank-death-flash {
        0%   { background: rgba(220, 50, 50, 0.55); }
        60%  { background: rgba(220, 50, 50, 0.2); }
        100% { background: transparent; }
      }
      .tank-cond-left { display: flex; flex-direction: column; flex: 1; }
      .tank-cond-name { font-size: 10px; color: #5599bb; }
      .tank-cap-warn { font-size: 9px; color: #ffcc44; margin-top: 1px; }
      .tank-cond-row.active .tank-cond-name { color: #7fd8ff; font-weight: bold; }
      .tank-cond-rings { display: flex; gap: 5px; }
      .tank-ring {
        width: 30px; height: 30px; border-radius: 50%;
        background: conic-gradient(from -90deg, var(--ring-color) calc(var(--pct, 0) * 1%), #0a1628 0);
        display: flex; align-items: center; justify-content: center;
        position: relative;
      }
      .tank-ring::before {
        content: ''; position: absolute; inset: 5px;
        background: #0d2137; border-radius: 50%;
      }
      .tank-ring span { position: relative; z-index: 1; font-size: 11px; line-height: 1; }
      .tank-ring.food    { --ring-color: #ffdd00; }
      .tank-ring.oxygen  { --ring-color: #44aaff; }
      .tank-ring.clean   { --ring-color: #44cc77; }
      .tank-ring.danger  { --ring-color: #ff4444; animation: gauge-pulse 0.8s ease-in-out infinite; }
      .tank-cond-row:not(.active) { padding: 2px 0; }
      .tank-cond-row:not(.active) .tank-cond-name { font-size: 9px; }
      .tank-cond-row:not(.active) .tank-cond-rings { gap: 3px; }
      .tank-cond-row:not(.active) .tank-ring { width: 20px; height: 20px; }
      .tank-cond-row:not(.active) .tank-ring::before { inset: 3px; }
      .tank-cond-row:not(.active) .tank-ring span { font-size: 8px; }

      /* Buttons */
      .btn {
        width: 100%; padding: 6px 8px; margin-bottom: 4px;
        background: #0d3a5c; border: 1px solid #1a6a9a; border-radius: 5px;
        color: #cce4ff; cursor: pointer; font-size: 11px;
        transition: background 0.15s, opacity 0.15s;
        text-align: center;
      }
      .btn:hover:not(:disabled) { background: #155070; }
      .btn:active:not(:disabled) { background: #1a6a9a; }
      .btn:disabled { opacity: 0.35; cursor: not-allowed; }
      .btn.primary { background: #0a5a8c; border-color: #2a9ad4; color: #ffffff; }
      .btn.primary:hover:not(:disabled) { background: #0d70a8; }
      .btn.warning { background: #5c2a00; border-color: #aa5500; color: #ffcc88; }
      .btn.debug-active { background: #3a005c; border-color: #aa44ff; color: #dd99ff; }

      .inv-item {
        display: flex; align-items: center; gap: 6px;
        padding: 5px 0; border-bottom: 1px solid #0d2137;
      }
      .inv-item:last-child { border-bottom: none; }
      .inv-icon { font-size: 18px; flex-shrink: 0; }
      .inv-info { flex: 1; display: flex; flex-direction: column; }
      .inv-name { font-size: 10px; color: #cce4ff; }
      .inv-desc { font-size: 9px; color: #3a6a8a; }
      .inv-count { font-size: 13px; font-weight: bold; color: #7fd8ff; min-width: 16px; text-align: center; }
      .inv-use-btn { width: auto; padding: 3px 8px; font-size: 10px; margin: 0; }
      #inventory-panel .panel-title { display: flex; justify-content: space-between; align-items: center; cursor: pointer; user-select: none; }
      #inv-collapse-btn { font-size: 9px; color: #5599bb; background: none; border: none; padding: 0; cursor: pointer; line-height: 1; }
      #inventory-panel.inv-collapsed .inv-desc { display: none; }
      #inventory-panel.inv-collapsed .inv-item { padding: 2px 0; }
      #inventory-panel.inv-collapsed .inv-icon { font-size: 14px; }

      .debug-timer {
        display: flex; align-items: baseline; gap: 6px;
        padding: 3px 0; border-bottom: 1px solid #0d2137; font-size: 10px;
      }
      .debug-timer:last-child { border-bottom: none; }
      .debug-time {
        font-variant-numeric: tabular-nums; color: #aa44ff;
        font-weight: bold; white-space: nowrap; min-width: 34px;
      }
      .debug-next { color: #88bbcc; line-height: 1.3; }

      /* Census */
      .census-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 3px; }
      .census-item { font-size: 10px; display: flex; justify-content: space-between; }
      .census-val { color: #7fd8ff; font-weight: bold; }

      /* Event log */
      #event-log { font-size: 10px; }
      .log-entry {
        padding: 2px 0; border-bottom: 1px solid #0d2137;
        line-height: 1.4; color: #88bbcc;
      }
      .log-entry.new { animation: log-flash 1s ease-out; }
      .log-tank { color: #44cc88; font-size: 9px; font-weight: bold; }


      /* Purify countdown */
      #purify-countdown {
        text-align: center; font-size: 11px; color: #5599bb;
        padding: 4px; display: none;
      }
      #purify-progress {
        height: 4px; background: #0a1628; border-radius: 2px;
        border: 1px solid #1a3a5c; margin-top: 4px; overflow: hidden; display: none;
      }
      #purify-bar {
        height: 100%; background: linear-gradient(90deg, #0055cc, #44aaff);
        border-radius: 2px; transition: width 0.5s;
      }

      /* ── TANK ── */
      #tank {
        grid-area: tank;
        position: relative;
        background: linear-gradient(180deg, #041020 0%, #062040 40%, #083060 100%);
        overflow: hidden;
      }

      /* Water overlay effect */
      #tank::before {
        content: '';
        position: absolute; top: 28px; left: 0; right: 0; bottom: 0;
        background: repeating-linear-gradient(
          0deg,
          transparent, transparent 40px,
          rgba(100,200,255,0.03) 40px, rgba(100,200,255,0.03) 41px
        );
        pointer-events: none; z-index: 1;
      }

      /* Bubbles */
      .bubble {
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, rgba(180,230,255,0.6), rgba(100,180,255,0.2));
        border: 1px solid rgba(150,210,255,0.4);
        animation: bubble-rise linear infinite;
        pointer-events: none;
      }

      /* ── AIRSTONE ── */
      .airstone-wrap {
        position: absolute; top: 0; bottom: 14px; z-index: 1;
        pointer-events: none; flex-direction: column; align-items: center; display: none;
      }
      .airstone-tube {
        position: absolute; top: 50px; bottom: 0;
        left: 50%; transform: translateX(-50%);
        width: 30px;
        background: rgba(160,210,240,0.05);
        border: 1px solid rgba(160,210,240,0.18);
        border-radius: 3px;
        z-index: 0;
      }
      .airstone-pipe {
        width: 4px; flex: 1; position: relative; z-index: 1;
        background: rgba(160,210,240,0.10);
        border: 1px solid rgba(160,210,240,0.20);
        border-radius: 2px;
      }
      .airstone-stone {
        width: 16px; height: 9px; position: relative; z-index: 1;
        background: linear-gradient(to bottom, #70808a, #4a5560);
        border-radius: 3px 3px 2px 2px;
        border: 1px solid #38424a;
        box-shadow: 0 1px 4px rgba(0,0,0,0.5);
      }

      /* Monkey container */
      #monkey-container { position: absolute; top: 28px; left: 0; right: 0; bottom: 0; z-index: 2; }

      /* Individual monkey */
      .monkey {
        position: absolute;
        left: 0; top: 0;
        font-size: 20px;
        line-height: 1;
        cursor: default;
        user-select: none;
        will-change: translate;
        transition: filter 0.3s;
      }
      .monkey.egg    { font-size: 18px; animation: egg-wiggle 2s ease-in-out infinite; }
      .monkey.baby   { font-size: 16px; }
      .monkey.juvenile { font-size: 19px; }
      .monkey.adult  { font-size: 22px; }
      .monkey.dead   { font-size: 18px; opacity: 0.7; }
      .monkey.pregnant { animation: pregnant-pulse 1.5s ease-in-out infinite; }

      .monkey-tooltip {
        position: absolute;
        bottom: 110%; left: 50%; transform: translateX(-50%);
        background: rgba(0,10,20,0.9); border: 1px solid #1a5f8a;
        border-radius: 4px; padding: 4px 6px; font-size: 9px;
        white-space: nowrap; color: #cce4ff; pointer-events: none;
        opacity: 0; transition: opacity 0.2s; z-index: 10;
      }
      .monkey:hover .monkey-tooltip { opacity: 1; }

      /* Tank overlay (setup) */
      #tank-overlay {
        position: absolute; top: 28px; left: 0; right: 0; bottom: 0; z-index: 20;
        background: rgba(4, 16, 32, 0.85);
        display: flex; flex-direction: column;
        align-items: center; justify-content: center; gap: 12px;
        text-align: center;
      }
      #tank-overlay h2 { color: #7fd8ff; font-size: 20px; }
      #tank-overlay p { color: #88bbcc; font-size: 13px; max-width: 280px; line-height: 1.5; }
      #tank-overlay .big-btn {
        padding: 12px 24px; font-size: 14px; border-radius: 8px;
        background: #0a5a8c; border: 2px solid #2a9ad4;
        color: #fff; cursor: pointer;
        transition: background 0.15s;
      }
      #tank-overlay .big-btn:hover { background: #0d70a8; }
      #overlay-emoji { font-size: 48px; }

      /* Notifications (float-up popups) */
      #notifications { position: absolute; bottom: 10px; right: 10px; z-index: 30; pointer-events: none; }
      .notif {
        background: rgba(10,30,50,0.9); border: 1px solid #2a9ad4;
        border-radius: 6px; padding: 6px 10px; margin-top: 4px;
        font-size: 11px; color: #cce4ff;
        animation: float-up 3s ease-out forwards;
      }

      /* ── STATUS BAR ── */
      #statusbar {
        grid-area: statusbar;
        background: #071424;
        border-top: 1px solid #1a3a5c;
        display: flex; align-items: center; padding: 0 12px;
        font-size: 11px; color: #5599bb;
        gap: 8px;
      }
      #statusbar.warning { color: #ffaa44; }
      #statusbar.danger  { color: #ff4444; }

      /* ── ANIMATIONS ── */
      @keyframes egg-wiggle {
        0%,100% { transform: rotate(-3deg); }
        50%      { transform: rotate(3deg); }
      }
      @keyframes pregnant-pulse {
        0%,100% { transform: scale(1.0); }
        50%      { transform: scale(1.15); }
      }
      @keyframes monkey-die {
        0%   { opacity: 1; transform: rotate(0deg) translateY(0); }
        100% { opacity: 0; transform: rotate(180deg) translateY(30px); }
      }
      @keyframes bubble-rise {
        0%   { bottom: 0; opacity: 0.7; }
        100% { bottom: 100%; opacity: 0; }
      }
      .bio-glow { filter: hue-rotate(150deg) saturate(3) drop-shadow(0 0 6px rgba(100,255,200,0.85)); }
      @keyframes log-flash {
        0%   { background: rgba(255,220,0,0.3); }
        100% { background: transparent; }
      }
      @keyframes float-up {
        0%   { opacity: 1; transform: translateY(0); }
        70%  { opacity: 1; }
        100% { opacity: 0; transform: translateY(-40px); }
      }
      @keyframes gauge-pulse {
        0%,100% { opacity: 1; }
        50%      { opacity: 0.5; }
      }

      .food-flake {
        position: absolute;
        color: #ccaa44;
        font-size: 10px;
        pointer-events: none;
        z-index: 3;
        animation: flake-fall linear forwards;
      }
      @keyframes flake-fall {
        0%   { opacity: 0.9; transform: translateY(0) rotate(0deg); }
        100% { opacity: 0;   transform: translateY(220px) rotate(200deg); }
      }

      .burst-bubble {
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, rgba(180,230,255,0.8), rgba(100,180,255,0.2));
        border: 1px solid rgba(150,210,255,0.6);
        pointer-events: none;
        z-index: 3;
        animation: burst-rise linear forwards;
      }
      @keyframes burst-rise {
        0%   { opacity: 0.85; transform: translateY(0); }
        100% { opacity: 0;    transform: translateY(-350px); }
      }

      /* ── DECORATIVE PLANTS ── */
      #plant-layer { position: absolute; bottom: 0; left: 0; right: 0; pointer-events: none; z-index: 1; }
      #tank-gravel {
        position: absolute; bottom: 0; left: 0; right: 0; height: 14px;
        background: linear-gradient(to top, #101a10, #1c2e1c);
        border-top: 1px solid #2a4a2a; pointer-events: none; z-index: 2;
      }
      .sw   { position: absolute; bottom: 14px; border-radius: 40% 60% 0 0; transform-origin: bottom center; }
      .pl   { position: absolute; bottom: 14px; border-radius: 50% 50% 0 50%; transform-origin: bottom center; }
      .fern { position: absolute; bottom: 14px; border-radius: 50% 10% 50% 10%; transform-origin: bottom center; }
      .hg   { position: absolute; bottom: 14px; border-radius: 50% 50% 0 0; transform-origin: bottom center; }
      @keyframes sway-l    { 0%,100% { transform: rotate(-8deg);  } 50% { transform: rotate(6deg);   } }
      @keyframes sway-r    { 0%,100% { transform: rotate(6deg);   } 50% { transform: rotate(-8deg);  } }
      @keyframes sway-s    { 0%,100% { transform: rotate(-4deg);  } 50% { transform: rotate(5deg);   } }
      @keyframes sway-fast { 0%,100% { transform: rotate(-12deg); } 50% { transform: rotate(12deg);  } }

      /* ── DEX BUTTON ── */
      #btn-dex {
        background: none; border: 1px solid #1a3a5c; border-radius: 6px;
        color: #5599bb; font-size: 16px; width: 36px; height: 36px;
        cursor: pointer; display: flex; align-items: center; justify-content: center;
        transition: background 0.15s, color 0.15s; flex-shrink: 0;
      }
      #btn-dex:hover { background: #0d2137; color: #7fd8ff; }
      #population-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        align-content: start;
        gap: 8px; padding: 4px 0;
      }
      .pop-card {
        background: #0d2137; border: 1px solid #1a3a5c; border-radius: 8px;
        padding: 10px 8px; cursor: pointer;
        display: flex; flex-direction: column; align-items: center; gap: 4px;
        text-align: center; position: relative;
      }
      .pop-card.dead { opacity: 0.45; }
      .pop-card-emoji  { font-size: 28px; line-height: 1; }
      .pop-card-name   { font-size: 11px; color: #cce4ff; font-weight: bold; }
      .pop-sex         { color: #5599bb; font-weight: normal; }
      .pop-card-badges { display: flex; gap: 4px; flex-wrap: wrap; justify-content: center; }
      .pop-stage { background: #0a3a5c; border-radius: 3px; padding: 1px 5px; font-size: 9px; color: #7fd8ff; }
      .pop-gen   { font-size: 9px; color: #5599bb; }
      .pop-tank-badge { font-size: 9px; color: #44cc88; background: rgba(0,40,20,0.7); border-radius: 3px; padding: 1px 4px; }
      .pop-card-health { font-size: 9px; color: #88bbcc; font-variant-numeric: tabular-nums; width: 100%; }
      .pop-bar   { color: #44cc77; letter-spacing: -1px; }
      .pop-hp    { color: #7fd8ff; }
      .pop-card-timer  { font-size: 9px; color: #5599bb; }
      .pop-age         { position: absolute; top: 5px; left: 6px; font-size: 9px; color: #5599bb; }
      .pop-preg        { position: absolute; top: 5px; right: 6px; font-size: 9px; color: #ff88cc; }
      .pop-sell-row    { display: flex; gap: 4px; margin-top: 4px; justify-content: center; flex-wrap: wrap; }
      .pop-action-btn  { font-size: 9px; padding: 2px 7px; margin: 0; width: auto; }
      .pop-sell-btn    { font-size: 9px; padding: 2px 8px; margin: 0; width: auto;
                         color: #ffe066; border-color: #6a5000; background: rgba(60,40,0,0.7); }
      .pop-sell-btn:hover { background: rgba(90,60,0,0.9); border-color: #aa8800; }
      .pop-traits      { font-size: 9px; color: #7faabb; line-height: 1.3; width: 100%; }
      .gene-table      { border-collapse: collapse; width: 100%; font-size: 9px; }
      .gene-table tr   { cursor: default; border-radius: 3px; }
      .gene-table tr:hover { background: #132840; }
      .gene-emoji      { padding: 2px 5px 2px 3px; font-size: 12px; }
      .gene-alleles    { color: #aad4ee; font-variant-numeric: tabular-nums; padding: 2px 3px; }
      .pop-empty       { text-align: center; color: #3a6a8a; padding: 20px; grid-column: 1/-1; }
      .pop-section-header {
        grid-column: 1 / -1;
        font-size: 11px; font-weight: bold; color: #7fd8ff;
        border-bottom: 1px solid #1a3a5c; padding: 8px 2px 4px;
        display: flex; align-items: center; gap: 6px; margin-top: 4px;
      }
      .pop-section-header:first-child { margin-top: 0; padding-top: 2px; }
      .pop-section-count {
        background: #0a3a5c; border-radius: 8px;
        padding: 1px 6px; font-size: 10px; color: #44aaff;
      }

      /* ── MONKEYDEX MODAL ── */
      #monkeydex-modal {
        position: fixed; inset: 0; z-index: 200;
        background: rgba(0,5,15,0.75);
        display: none; align-items: center; justify-content: center;
      }
      #monkeydex-modal.open { display: flex; }
      #monkeydex-popup {
        background: #0d2137; border: 1px solid #1a5f8a;
        border-radius: 10px; padding: 18px; width: min(1440px, 94vw); max-height: 82vh;
        overflow: hidden; box-shadow: 0 12px 48px rgba(0,0,0,0.8);
        display: flex; flex-direction: column; gap: 10px;
      }
      .dex-header {
        display: flex; justify-content: space-between; align-items: center;
        font-size: 14px; font-weight: bold; color: #7fd8ff;
        border-bottom: 1px solid #1a3a5c; padding-bottom: 8px; flex-shrink: 0;
      }
      .dex-close-btn {
        background: none; border: none; color: #5599bb;
        font-size: 18px; cursor: pointer; line-height: 1;
      }
      .dex-close-btn:hover { color: #7fd8ff; }
      .dex-note {
        font-size: 10px; color: #5599bb; text-align: center;
        padding: 2px 0 4px; flex-shrink: 0;
      }
      #dex-body {
        display: flex; flex-direction: row; gap: 16px; flex: 1; overflow: hidden; min-height: 0;
      }
      #dex-grid {
        flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; padding-right: 3px;
      }
      .dex-grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
      .dex-grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
      .dex-section-header {
        font-size: 10px; text-transform: uppercase; letter-spacing: 1px;
        color: #5599bb; border-bottom: 1px solid #1a3a5c; padding-bottom: 4px; margin-top: 6px;
      }
      .dex-count { font-size: 9px; color: #7fd8ff; }
      .dex-card {
        background: #071424; border: 1px solid #1a3a5c; border-radius: 8px;
        padding: 10px 6px; text-align: center;
        display: flex; flex-direction: column; align-items: center; gap: 4px;
      }
      .dex-card.undiscovered { opacity: 0.45; }
      .dex-emoji { font-size: 26px; line-height: 1; min-height: 30px; }
      .dex-name  { font-size: 11px; font-weight: bold; }
      .dex-rarity { font-size: 8px; text-transform: uppercase; letter-spacing: 1px; }
      .dex-desc  { font-size: 9px; color: #88bbcc; line-height: 1.4; }
      .dex-found { font-size: 9px; color: #44cc77; }
      /* ── MILESTONES PANEL ── */
      #dex-milestones {
        width: 280px; flex-shrink: 0; overflow-y: auto;
        display: flex; flex-direction: column; gap: 6px;
        border-left: 1px solid #1a3a5c; padding-left: 16px; padding-right: 3px;
      }
      .ms-section-header {
        font-size: 10px; text-transform: uppercase; letter-spacing: 1px;
        color: #5599bb; border-bottom: 1px solid #1a3a5c; padding-bottom: 4px;
        margin-bottom: 2px; flex-shrink: 0;
      }
      .ms-card {
        background: #071424; border: 1px solid #1a3a5c; border-radius: 6px;
        padding: 8px 10px; display: flex; flex-direction: column; gap: 3px;
      }
      .ms-card.ms-complete { border-color: #2a6a3c; background: #071e10; }
      .ms-top { display: flex; align-items: center; gap: 6px; }
      .ms-emoji { font-size: 16px; line-height: 1; }
      .ms-name  { font-size: 11px; font-weight: bold; color: #cce4ff; }
      .ms-desc  { font-size: 9px; color: #5599bb; line-height: 1.3; }
      .ms-reward { font-size: 9px; color: #7fd8ff; }
      .ms-done  { font-size: 9px; color: #44cc77; }
      .ms-progress-bar { height: 4px; background: #0a2a40; border-radius: 2px; margin-top: 2px; }
      .ms-progress-fill { height: 100%; background: #1a7faa; border-radius: 2px; }
      .ms-progress-label { font-size: 9px; color: #5599bb; }

      /* ── TANK SELECTOR BAR ── */
      #tank-selector-bar {
        position: absolute; top: 0; right: 0;
        z-index: 11; display: flex; gap: 2px; align-items: flex-end;
      }
      .tank-sel-btn {
        background: rgba(4,16,32,0.85); border: 1px solid #1a3a5c;
        border-bottom: none;
        padding: 5px 12px; font-size: 11px; color: #5599bb;
        cursor: pointer; transition: background 0.15s, color 0.15s;
      }
      .tank-sel-btn:hover:not(:disabled) { background: rgba(13,33,55,0.9); color: #aad4ee; }
      .tank-sel-btn.active { background: #0d2137; color: #7fd8ff; }
      .tank-buy-btn { color: #44cc88; border-color: #1a5a3c; }
      .tank-buy-btn:hover:not(:disabled) { background: rgba(4,20,12,0.95); color: #66ffaa; }
      .tank-buy-btn:disabled { opacity: 0.4; cursor: not-allowed; }
      .tank-mgr-btn { color: #aaa8cc; border-color: #2a2a5c; margin-left: 6px; }
      .tank-mgr-btn:hover { background: rgba(20,18,48,0.95); color: #ccccff; }
      .tank-mgr-btn.active { background: #0d2137; color: #7fd8ff; border-color: #2a7ab8; }

      /* ── TANK TABS ── */
      #tank-tab-bar {
        position: absolute; top: 0; left: 0;
        z-index: 10; display: flex; gap: 0;
      }
      .tank-tab {
        background: rgba(4,16,32,0.85); border: 1px solid #1a3a5c;
        border-bottom: none; border-right: none;
        padding: 5px 14px; font-size: 11px; color: #5599bb;
        cursor: pointer; transition: background 0.15s, color 0.15s;
      }
      .tank-tab:last-child { border-right: 1px solid #1a3a5c; }
      .tank-tab:hover { background: rgba(13,33,55,0.9); color: #aad4ee; }
      .tank-tab.active { background: #0d2137; color: #7fd8ff; border-bottom: 1px solid #0d2137; }

      /* ── EGG STORAGE MODAL ── */
      #egg-storage-modal {
        position: fixed; inset: 0; z-index: 200;
        background: rgba(0,5,15,0.75);
        display: none; align-items: center; justify-content: center;
      }
      #egg-storage-modal.open { display: flex; }
      #egg-storage-popup {
        background: #0d2137; border: 1px solid #1a5f8a;
        border-radius: 10px; padding: 20px 24px;
        box-shadow: 0 12px 48px rgba(0,0,0,0.8);
        display: flex; flex-direction: column; gap: 10px;
        width: 420px; max-width: 92vw; max-height: 78vh;
      }
      #egg-storage-title {
        font-size: 13px; font-weight: bold; color: #7fd8ff;
        border-bottom: 1px solid #1a3a5c; padding-bottom: 8px; text-align: center;
        flex-shrink: 0;
      }
      #egs-search {
        width: 100%; box-sizing: border-box; background: #0a1628;
        border: 1px solid #1a3a5c; border-radius: 5px;
        padding: 5px 9px; font-size: 11px; color: #cce4ff; outline: none; flex-shrink: 0;
      }
      #egs-search::placeholder { color: #3a5a78; }
      #egs-search:focus { border-color: #2a7ab8; }
      #egg-storage-list { overflow-y: auto; flex: 1; display: flex; flex-direction: column; gap: 8px; }
      .egs-group-header {
        font-size: 9px; color: #5599bb; text-transform: uppercase; letter-spacing: 0.5px;
        padding: 4px 0 2px; border-bottom: 1px solid #0d2137;
        display: flex; align-items: center; gap: 6px;
      }
      .egs-group-label { flex: 1; }
      .egs-group-actions { display: flex; align-items: center; gap: 4px; }
      .egs-place-all-btn {
        font-size: 9px; color: #88bbcc; background: #071424;
        border: 1px solid #1a3a5c; border-radius: 4px; padding: 2px 7px;
        cursor: pointer; text-transform: none; letter-spacing: 0; white-space: nowrap;
      }
      .egs-place-all-btn:hover { border-color: #2a7ab8; color: #7fd8ff; }
      .egs-sell-all-btn {
        font-size: 9px; color: #ffcc44; background: #1a1000;
        border: 1px solid #5a4000; border-radius: 4px; padding: 2px 7px;
        cursor: pointer; text-transform: none; letter-spacing: 0; white-space: nowrap;
      }
      .egs-sell-all-btn:hover { border-color: #aa8800; color: #ffe066; }
      .egs-colour-group { display: flex; flex-direction: column; gap: 3px; }
      .egs-egg-card {
        background: #071424; border: 1px solid #1a3a5c; border-radius: 6px;
        padding: 6px 10px; display: flex; align-items: center; gap: 8px;
      }
      .egs-egg-card.placing { border-color: #2a7ab8; background: #0a1e38; }
      .egs-egg-emoji { font-size: 18px; flex-shrink: 0; }
      .egs-egg-info { flex: 1; display: flex; flex-direction: column; gap: 1px; min-width: 0; }
      .egs-egg-name { font-size: 10px; color: #cce4ff; }
      .egs-egg-traits { font-size: 9px; color: #5599bb; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      .egs-card-actions { display: flex; align-items: center; gap: 4px; flex-shrink: 0; }
      .egs-sell-btn {
        font-size: 9px; color: #ffcc44; background: #1a1000;
        border: 1px solid #5a4000; border-radius: 4px; padding: 3px 8px;
        cursor: pointer; white-space: nowrap;
      }
      .egs-sell-btn:hover { border-color: #aa8800; color: #ffe066; }
      .egs-place-btn {
        font-size: 9px; color: #44cc88; background: #041a10;
        border: 1px solid #1a5a3c; border-radius: 4px; padding: 3px 8px;
        cursor: pointer; white-space: nowrap;
      }
      .egs-place-btn:hover { color: #66ffaa; border-color: #2a8a5c; }
      .egs-tank-btns { display: flex; gap: 4px; flex-wrap: wrap; }
      .egs-tank-btn {
        font-size: 9px; color: #7fd8ff; background: #0a1628;
        border: 1px solid #1a3a5c; border-radius: 4px; padding: 3px 8px; cursor: pointer;
      }
      .egs-tank-btn:hover { border-color: #2a7ab8; }
      #egg-storage-footer { display: flex; justify-content: flex-end; flex-shrink: 0; }
      .egs-egg-emoji-wrap { cursor: help; flex-shrink: 0; font-size: 18px; line-height: 1; }
      #egs-gene-tooltip {
        position: fixed; z-index: 500; display: none; pointer-events: none;
        background: rgba(0,8,20,0.97); border: 1px solid #1a5f8a;
        border-radius: 7px; padding: 8px 10px;
        box-shadow: 0 6px 24px rgba(0,0,0,0.7);
        min-width: 190px;
      }
      #egs-gene-tooltip-title {
        font-size: 10px; font-weight: bold; color: #7fd8ff;
        border-bottom: 1px solid #1a3a5c; padding-bottom: 4px; margin-bottom: 4px;
      }

      /* ── SHOP MODAL ── */
      #shop-modal {
        position: fixed; inset: 0; z-index: 200;
        background: rgba(0,5,15,0.78);
        display: none; align-items: center; justify-content: center;
      }
      #shop-modal.open { display: flex; }
      #shop-popup {
        background: #0d2137; border: 1px solid #1a5f8a;
        border-radius: 10px; padding: 20px 24px;
        box-shadow: 0 12px 48px rgba(0,0,0,0.8);
        display: flex; flex-direction: column; gap: 10px;
        width: 460px; max-width: 94vw; max-height: 82vh;
      }
      #shop-title {
        font-size: 14px; font-weight: bold; color: #7fd8ff;
        text-align: center; flex-shrink: 0;
        border-bottom: 1px solid #1a3a5c; padding-bottom: 8px;
      }
      #shop-balance {
        font-size: 11px; color: #88bbcc; text-align: right; flex-shrink: 0;
      }
      #shop-balance-val { color: #7fd8ff; font-weight: bold; }
      #shop-item-list { overflow-y: auto; flex: 1; display: flex; flex-direction: column; gap: 4px; }
      .shop-section-header {
        font-size: 9px; color: #2a7ab8; text-transform: uppercase;
        letter-spacing: 0.8px; padding: 8px 0 4px; font-weight: bold;
      }
      .shop-section-header:first-child { padding-top: 0; }
      .shop-item {
        background: #071424; border: 1px solid #1a3a5c; border-radius: 6px;
        padding: 8px 10px; display: flex; align-items: center; gap: 10px;
      }
      .shop-item-owned { opacity: 0.55; }
      .shop-item-info { flex: 1; display: flex; flex-direction: column; gap: 2px; min-width: 0; }
      .shop-item-label { font-size: 11px; color: #cce4ff; font-weight: bold; }
      .shop-item-desc  { font-size: 9px; color: #5599bb; line-height: 1.4; }
      .shop-item-action { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; flex-shrink: 0; }
      .shop-item-cost  { font-size: 10px; color: #ffe066; white-space: nowrap; }
      .shop-buy-btn    { font-size: 10px; padding: 3px 10px; white-space: nowrap; }
      .shop-active-badge { font-size: 8px; color: #44ff88; font-weight: bold; }
      .shop-owned-badge  { font-size: 8px; color: #44cc88; font-weight: bold; }
      .shop-stock-badge  { font-size: 8px; color: #5599bb; font-weight: bold; }
      .shop-time-left    { color: #44cc88; font-style: normal; }
      .shop-grace-banner {
        background: rgba(0,60,30,0.6); border: 1px solid #1a7a4a;
        border-radius: 6px; padding: 6px 10px;
        font-size: 10px; color: #44ff88; text-align: center; flex-shrink: 0;
      }
      #shop-footer { display: flex; justify-content: flex-end; flex-shrink: 0; }

      /* ── MOVE MONKEY MODAL ── */
      #move-monkey-modal {
        position: fixed; inset: 0; z-index: 200;
        background: rgba(0,5,15,0.75);
        display: none; align-items: center; justify-content: center;
      }
      #move-monkey-modal.open { display: flex; }
      #move-monkey-popup {
        background: #0d2137; border: 1px solid #1a5f8a;
        border-radius: 10px; padding: 20px 24px;
        box-shadow: 0 12px 48px rgba(0,0,0,0.8);
        display: flex; flex-direction: column; gap: 12px;
        min-width: 200px; align-items: center;
      }
      #move-monkey-title {
        font-size: 13px; font-weight: bold; color: #7fd8ff;
        border-bottom: 1px solid #1a3a5c; padding-bottom: 8px; width: 100%; text-align: center;
      }
      #move-monkey-tanks { display: flex; flex-direction: column; gap: 6px; width: 100%; }
      #move-monkey-tanks .btn { width: 100%; }

      /* ── LIFE SUPPORT VIEW ── */
      #life-support-view {
        position: absolute; inset: 0; z-index: 5;
        background: #041020;
        display: none; flex-direction: column;
        overflow-y: auto; padding: 36px 12px 12px;
        color: #7fd8ff; font-size: 16px;
      }
      #life-support-view.active { display: flex; }
      #life-support-view-title {
        font-size: 12px; font-weight: bold; color: #7fd8ff;
        border-bottom: 1px solid #1a3a5c; padding-bottom: 8px; margin-bottom: 6px;
        flex-shrink: 0;
      }

      /* ── POPULATION VIEW ── */
      #population-view {
        position: absolute; inset: 0; z-index: 5;
        background: #041020;
        display: none; flex-direction: column;
        overflow-y: hidden; padding: 36px 12px 0;
      }
      #population-view.active { display: flex; }
      #population-view-title {
        font-size: 12px; font-weight: bold; color: #7fd8ff;
        border-bottom: 1px solid #1a3a5c; padding-bottom: 8px; margin-bottom: 6px;
        flex-shrink: 0;
      }
      #pop-controls {
        flex-shrink: 0; display: flex; flex-direction: column; gap: 6px;
        margin-bottom: 8px;
      }
      #pop-search {
        width: 100%; box-sizing: border-box;
        background: #0a1628; border: 1px solid #1a3a5c; border-radius: 5px;
        padding: 5px 9px; font-size: 11px; color: #cce4ff; outline: none;
      }
      #pop-search::placeholder { color: #3a5a78; }
      #pop-search:focus { border-color: #2a7ab8; }
      #pop-stage-filters {
        display: flex; gap: 10px; flex-wrap: wrap; align-items: center;
        padding: 3px 0 6px; border-bottom: 1px solid #1a3a5c;
      }
      .pop-filter-label {
        display: flex; align-items: center; gap: 4px;
        font-size: 10px; color: #88bbcc; cursor: pointer; user-select: none;
      }
      .pop-filter-label input[type="checkbox"] { cursor: pointer; accent-color: #2a7ab8; margin: 0; }
      #population-list { overflow-y: auto; flex: 1; padding-bottom: 12px; }

      /* ── TANK MANAGER VIEW ── */
      #tank-manager-view {
        position: absolute; inset: 0; z-index: 5;
        background: #041020;
        display: none; flex-direction: column;
        overflow-y: auto; padding: 36px 12px 12px;
      }
      #tank-manager-view.active { display: flex; }
      #tank-manager-title {
        font-size: 12px; font-weight: bold; color: #7fd8ff;
        border-bottom: 1px solid #1a3a5c; padding-bottom: 8px; margin-bottom: 10px;
        flex-shrink: 0;
      }
      #tank-manager-list { display: flex; flex-direction: column; gap: 10px; }
      .tm-card {
        background: #0d2137; border: 1px solid #1a3a5c; border-radius: 8px;
        padding: 10px 12px; display: flex; flex-direction: column; gap: 8px;
      }
      .tm-card.active-tank { border-color: #2a7ab8; }
      .tm-card-header { display: flex; align-items: center; gap: 6px; }
      .tm-tank-name {
        font-size: 13px; font-weight: bold; color: #7fd8ff;
        flex: 1; cursor: text; border-bottom: 1px dashed transparent;
      }
      .tm-tank-name:hover { border-bottom-color: #2a7ab8; }
      .tm-tank-name-input {
        font-size: 13px; font-weight: bold; color: #7fd8ff;
        background: #0a1628; border: 1px solid #2a7ab8; border-radius: 4px;
        padding: 1px 6px; flex: 1; outline: none;
      }
      .tm-active-badge {
        font-size: 9px; color: #44aaff; background: rgba(0,80,160,0.3);
        border: 1px solid #1a5080; border-radius: 3px; padding: 1px 5px;
      }
      .tm-switch-btn {
        font-size: 9px; color: #88bbcc; background: #071424;
        border: 1px solid #1a3a5c; border-radius: 3px; padding: 1px 6px; cursor: pointer;
      }
      .tm-switch-btn:hover { border-color: #2a7ab8; color: #7fd8ff; }
      .tm-section-label {
        font-size: 9px; color: #5599bb; text-transform: uppercase; letter-spacing: 0.5px;
        margin-bottom: 3px;
      }
      .tm-gauges { display: flex; flex-direction: row; gap: 8px; align-items: center; }
      .tm-gauge-row { flex: 1; display: flex; align-items: center; gap: 4px; }
      .tm-gauge-icon { font-size: 11px; width: 16px; text-align: center; }
      .tm-gauge-bar-wrap {
        flex: 1; height: 7px; background: #0a1628; border-radius: 3px;
        border: 1px solid #1a3a5c; overflow: hidden;
      }
      .tm-gauge-bar {
        height: 100%; border-radius: 3px; transition: width 0.4s;
      }
      .tm-gauge-bar.food  { background: linear-gradient(90deg, #cc8800, #ffdd00); }
      .tm-gauge-bar.oxy   { background: linear-gradient(90deg, #0055cc, #44aaff); }
      .tm-gauge-bar.clean { background: linear-gradient(90deg, #006633, #44cc77); }
      .tm-gauge-bar.danger { background: linear-gradient(90deg, #880000, #ff4444) !important; }
      .tm-gauge-val { font-size: 9px; color: #88bbcc; width: 52px; text-align: right; }
      .tm-pop { display: flex; gap: 5px; flex-wrap: wrap; align-items: center; }
      .tm-pop-badge {
        font-size: 10px; color: #88bbcc; background: #071424;
        border: 1px solid #1a3a5c; border-radius: 4px; padding: 2px 6px;
        white-space: nowrap;
      }
      .tm-pop-badge.zero { opacity: 0.3; }
      .tm-ls { display: flex; gap: 5px; }
      .tm-ls-item {
        flex: 1; background: #071424; border: 1px solid #1a3a5c; border-radius: 5px;
        padding: 5px 6px; display: flex; flex-direction: column; gap: 3px; min-width: 0;
      }
      .tm-ls-title { font-size: 9px; color: #5599bb; }
      .tm-ls-level { font-size: 10px; color: #7fd8ff; font-weight: bold; }
      .tm-ls-timer { font-size: 9px; color: #88bbcc; }
      .tm-ls-bar-wrap {
        height: 3px; background: #0a1628; border-radius: 2px; overflow: hidden;
      }
      .tm-ls-bar {
        height: 100%; background: linear-gradient(90deg, #0055cc, #44aaff);
        border-radius: 2px; transition: width 0.4s;
      }

      .tm-upgrades-grid {
        display: grid; grid-template-columns: auto auto; align-items: center; gap: 4px 8px; width: fit-content;
      }
      .tm-cap-desc { font-size: 9px; color: #5599bb; }
      .tm-cap-badge { font-size: 9px; color: #44cc88; font-style: italic; }
      .tm-cap-btn {
        font-size: 10px; color: #aaddff; background: rgba(0,30,60,0.7);
        border: 1px solid #1a5080; border-radius: 4px; padding: 3px 10px; cursor: pointer;
        white-space: nowrap; flex-shrink: 0;
      }
      .tm-cap-btn:hover:not(:disabled) { background: rgba(0,50,90,0.9); border-color: #3388bb; }
      .tm-cap-btn:disabled { opacity: 0.4; cursor: default; }
      .tm-toggle-btn { color: #778899; border-color: #334455; }
      .tm-toggle-btn.active { color: #44ee88; border-color: #22aa55; background: rgba(0,60,30,0.7); }
      .tm-toggle-btn.active:hover { background: rgba(0,80,40,0.9); }

      #life-support-content {
        display: flex; flex-wrap: wrap; gap: 16px;
        justify-content: flex-start; align-content: flex-start;
      }

      /* ── LIFE SUPPORT PANELS ── */
      .ls-panel {
        width: 220px;
        background: #0d2137; border: 1px solid #1a3a5c; border-radius: 8px;
        padding: 12px; display: flex; flex-direction: column; gap: 10px;
      }
      .ls-panel-title {
        font-size: 12px; font-weight: bold; color: #7fd8ff;
        border-bottom: 1px solid #1a3a5c; padding-bottom: 6px;
      }
      .ls-level-track {
        display: flex; align-items: center; gap: 0; padding: 4px 0;
      }
      .ls-level-node {
        width: 18px; height: 18px; border-radius: 50%;
        background: #0a1628; border: 2px solid #1a3a5c;
        flex-shrink: 0; transition: background 0.3s, border-color 0.3s;
      }
      .ls-level-node.active {
        background: #0a5a8c; border-color: #2a9ad4;
        box-shadow: 0 0 6px rgba(42,154,212,0.6);
      }
      .ls-level-line {
        flex: 1; height: 2px; background: #1a3a5c;
      }
      .ls-info-grid { display: flex; flex-direction: column; gap: 4px; }
      .ls-info-row {
        display: flex; justify-content: space-between;
        font-size: 11px; color: #88bbcc;
      }
      .ls-duration-track {
        height: 6px; background: #0a1628; border-radius: 3px;
        border: 1px solid #1a3a5c; overflow: hidden;
      }
      .ls-duration-bar {
        height: 100%; background: linear-gradient(90deg, #0055cc, #44aaff);
        border-radius: 3px; transition: width 0.5s;
      }

      /* ── MOLTS ── */
      .molt {
        position: absolute;
        font-size: 16px; line-height: 1;
        cursor: pointer; user-select: none;
        opacity: 0.55;
        filter: sepia(1) brightness(0.75);
        z-index: 2;
        transition: top 2s ease-out, opacity 0.15s;
      }
      .molt:hover { opacity: 0.9; }
      .molt.molt-bobbing {
        animation: molt-bob 2.5s ease-in-out infinite;
      }
      .molt.molt-dissolving {
        animation: molt-dissolve 1.5s ease-out forwards !important;
        pointer-events: none;
        transition: none;
      }
      @keyframes molt-bob {
        0%,100% { transform: translateY(0) rotate(-4deg); }
        50%      { transform: translateY(-5px) rotate(4deg); }
      }
      @keyframes molt-dissolve {
        0%   { opacity: 0.55; transform: scale(1); filter: sepia(1) brightness(0.75); }
        60%  { opacity: 0.3;  transform: scale(1.1) translateY(-6px); filter: sepia(1) brightness(1.2) blur(2px); }
        100% { opacity: 0;    transform: scale(0.2) translateY(-20px); filter: sepia(1) brightness(2) blur(6px); }
      }

      /* ── RARE VARIANT GLOWS (applied via JS inline style) ── */
      @keyframes biolum-pulse {
        0%,100% { text-shadow: 0 0 8px 3px rgba(100,255,200,0.6); }
        50%      { text-shadow: 0 0 14px 6px rgba(100,255,200,0.9); }
      }
    </style>
  </head>
  <body>

    <!-- HEADER -->
    <div id="header">
      <button id="sidebar-collapse-btn" title="Collapse sidebar">◀</button>
      <h1>🦐 Sea Monkey Farm</h1>
      <div class="header-census">
        <div class="hstat">
          <span class="hstat-label">🥚 Eggs</span>
          <span class="hstat-value" id="cnt-eggs">0</span>
        </div>
        <div class="hstat">
          <span class="hstat-label">🐠 Babies</span>
          <span class="hstat-value" id="cnt-babies">0</span>
        </div>
        <div class="hstat">
          <span class="hstat-label">🐟 Juveniles</span>
          <span class="hstat-value" id="cnt-juveniles">0</span>
        </div>
        <div class="hstat">
          <span class="hstat-label">🦐 Adults</span>
          <span class="hstat-value" id="cnt-adults">0</span>
        </div>
      </div>
      <button id="btn-pause" title="Pause simulation">⏸</button>
      <button id="btn-dex" title="Monkeydex — Rare Variants">🔬</button>
      <button id="btn-settings" title="Settings">⚙️</button>
      <div class="header-stats">
        <div class="hstat">
          <span class="hstat-label">Population</span>
          <span class="hstat-value" id="stat-pop">0</span>
        </div>
        <div class="hstat">
          <span class="hstat-label">Generation</span>
          <span class="hstat-value" id="stat-gen">1</span>
        </div>
        <div class="hstat">
          <span class="hstat-label">Born</span>
          <span class="hstat-value" id="stat-born">0</span>
        </div>
        <div class="hstat">
          <span class="hstat-label">Died</span>
          <span class="hstat-value" id="stat-died">0</span>
        </div>
      </div>
    </div>

    <!-- SETTINGS POPUP -->
    <div id="settings-overlay">
      <div id="settings-popup">
        <div class="settings-title">⚙️ Settings</div>
        <div class="settings-section">
          <div class="settings-row">
            <span>Debug Mode</span>
            <button class="btn" id="btn-debug" style="width:auto; padding:4px 10px;">🐛 Off</button>
          </div>
          <div id="debug-controls" style="display:none;">
            <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
              <span style="font-size:10px; color:#5599bb;">Speed</span>
              <input type="range" id="debug-speed-slider" min="1" max="20" step="1" value="1" style="flex:1; accent-color:#aa44ff;">
              <span id="debug-speed-label" style="font-size:11px; color:#aa44ff; font-weight:bold; min-width:28px; text-align:right;">1×</span>
            </div>
            <div style="display:flex; gap:4px;">
              <button class="btn" id="btn-debug-give-life"    style="flex:1; font-size:10px; padding:4px;">+🧪 Life</button>
              <button class="btn" id="btn-debug-give-egg"     style="flex:1; font-size:10px; padding:4px;">+🥚 Eggs</button>
              <button class="btn" id="btn-debug-give-flakes"  style="flex:1; font-size:10px; padding:4px;">+✨ Flakes</button>
              <button class="btn" id="btn-debug-give-currency" style="flex:1; font-size:10px; padding:4px;">+💷 £100</button>
            </div>
            <div style="margin-top:6px; display:flex; flex-direction:column; gap:3px;">
              <div style="font-size:9px; color:#5599bb; text-transform:uppercase; letter-spacing:1px; margin-bottom:2px;">Lock Conditions</div>
              <div style="display:flex; align-items:center; gap:4px;">
                <span style="font-size:12px; min-width:20px;">🍔</span>
                <button class="btn" id="dbg-food-0"   style="flex:1; font-size:9px; padding:2px;">0</button>
                <button class="btn debug-active" id="dbg-food-nrm" style="flex:1; font-size:9px; padding:2px;">Normal</button>
                <button class="btn" id="dbg-food-100" style="flex:1; font-size:9px; padding:2px;">100</button>
              </div>
              <div style="display:flex; align-items:center; gap:4px;">
                <span style="font-size:12px; min-width:20px;">💨</span>
                <button class="btn" id="dbg-oxygen-0"   style="flex:1; font-size:9px; padding:2px;">0</button>
                <button class="btn debug-active" id="dbg-oxygen-nrm" style="flex:1; font-size:9px; padding:2px;">Normal</button>
                <button class="btn" id="dbg-oxygen-100" style="flex:1; font-size:9px; padding:2px;">100</button>
              </div>
              <div style="display:flex; align-items:center; gap:4px;">
                <span style="font-size:12px; min-width:20px;">🧹</span>
                <button class="btn" id="dbg-clean-0"   style="flex:1; font-size:9px; padding:2px;">0</button>
                <button class="btn debug-active" id="dbg-clean-nrm" style="flex:1; font-size:9px; padding:2px;">Normal</button>
                <button class="btn" id="dbg-clean-100" style="flex:1; font-size:9px; padding:2px;">100</button>
              </div>
              <div style="font-size:9px; color:#5599bb; text-transform:uppercase; letter-spacing:1px; margin-top:4px; margin-bottom:2px;">Life Support Level</div>
              <div style="display:flex; align-items:center; gap:3px;">
                <span style="font-size:12px; min-width:20px;">💨</span>
                <button class="btn debug-active" id="dbg-aer-nrm" style="flex:1; font-size:8px; padding:2px;">✕</button>
                <button class="btn" id="dbg-aer-0" style="flex:1; font-size:8px; padding:2px;">0</button>
                <button class="btn" id="dbg-aer-1" style="flex:1; font-size:8px; padding:2px;">1</button>
                <button class="btn" id="dbg-aer-2" style="flex:1; font-size:8px; padding:2px;">2</button>
                <button class="btn" id="dbg-aer-3" style="flex:1; font-size:8px; padding:2px;">3</button>
                <button class="btn" id="dbg-aer-4" style="flex:1; font-size:8px; padding:2px;">4</button>
                <button class="btn" id="dbg-aer-5" style="flex:1; font-size:8px; padding:2px;">5</button>
              </div>
              <div style="display:flex; align-items:center; gap:3px;">
                <span style="font-size:12px; min-width:20px;">🧹</span>
                <button class="btn debug-active" id="dbg-skim-nrm" style="flex:1; font-size:8px; padding:2px;">✕</button>
                <button class="btn" id="dbg-skim-0" style="flex:1; font-size:8px; padding:2px;">0</button>
                <button class="btn" id="dbg-skim-1" style="flex:1; font-size:8px; padding:2px;">1</button>
                <button class="btn" id="dbg-skim-2" style="flex:1; font-size:8px; padding:2px;">2</button>
                <button class="btn" id="dbg-skim-3" style="flex:1; font-size:8px; padding:2px;">3</button>
                <button class="btn" id="dbg-skim-4" style="flex:1; font-size:8px; padding:2px;">4</button>
                <button class="btn" id="dbg-skim-5" style="flex:1; font-size:8px; padding:2px;">5</button>
              </div>
              <div style="display:flex; align-items:center; gap:3px;">
                <span style="font-size:12px; min-width:20px;">🍽️</span>
                <button class="btn debug-active" id="dbg-feeder-nrm" style="flex:1; font-size:8px; padding:2px;">✕</button>
                <button class="btn" id="dbg-feeder-0" style="flex:1; font-size:8px; padding:2px;">0</button>
                <button class="btn" id="dbg-feeder-1" style="flex:1; font-size:8px; padding:2px;">1</button>
                <button class="btn" id="dbg-feeder-2" style="flex:1; font-size:8px; padding:2px;">2</button>
                <button class="btn" id="dbg-feeder-3" style="flex:1; font-size:8px; padding:2px;">3</button>
                <button class="btn" id="dbg-feeder-4" style="flex:1; font-size:8px; padding:2px;">4</button>
                <button class="btn" id="dbg-feeder-5" style="flex:1; font-size:8px; padding:2px;">5</button>
              </div>
            </div>
          </div>
        </div>
        <div class="settings-section">
          <div class="settings-row">
            <span>FPS</span>
            <span id="fps-value" style="font-size:11px; color:#7fd8ff; font-weight:bold; font-variant-numeric:tabular-nums;">—</span>
          </div>
          <div class="settings-row">
            <span style="color:#5599bb;">Pop at FPS stress</span>
            <input id="fps-stress-pop" type="number" min="1" step="1"
              style="width:56px; background:#0a1628; border:1px solid #1a3a5c; border-radius:4px; color:#7faabb; font-size:11px; font-variant-numeric:tabular-nums; padding:2px 4px; text-align:right;"
              placeholder="—">
          </div>
          <div class="settings-row" id="fps-stress-reset-row" style="display:none;">
            <button class="btn" id="btn-reset-fps-stress" style="font-size:10px; padding:3px 8px; color:#ff9944; border-color:#7a4a22;">🔄 Reset FPS Cap</button>
          </div>
          <div class="settings-row">
            <span style="color:#5599bb;">Limit view to cap</span>
            <label class="toggle-switch">
              <input type="checkbox" id="toggle-limit-view">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="settings-row">
            <span style="color:#5599bb;">Bio Glow</span>
            <label class="toggle-switch">
              <input type="checkbox" id="toggle-bio-glow">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="settings-row">
            <span>Active Timers</span>
            <label class="toggle-switch">
              <input type="checkbox" id="toggle-timers">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        <div class="settings-section">
          <button class="btn" id="btn-save">💾 Save Progress</button>
          <button class="btn" id="btn-reload">🔄 Reload Game</button>
          <button class="btn warning" id="btn-reset">🗑️ Reset Tank</button>
        </div>
        <div class="settings-section">
          <div class="settings-row">
            <span style="color:#5599bb;">Account Age</span>
            <span id="stat-tank-age" style="font-size:11px; color:#7fd8ff; font-variant-numeric:tabular-nums;">—</span>
          </div>
          <div class="settings-row">
            <span style="color:#5599bb;">Play Time</span>
            <span id="stat-play-time" style="font-size:11px; color:#7fd8ff; font-variant-numeric:tabular-nums;">—</span>
          </div>
          <div class="settings-row">
            <span style="color:#5599bb;">Offline Time</span>
            <span id="stat-offline-time" style="font-size:11px; color:#7fd8ff; font-variant-numeric:tabular-nums;">—</span>
          </div>
        </div>
        <div class="settings-section">
          <div class="settings-row">
            <span>Next update check</span>
            <span id="update-countdown" style="font-size:11px; color:#7fd8ff; font-variant-numeric:tabular-nums;">—</span>
          </div>
        </div>
        <div style="text-align:center; font-size:10px; color:#3a6a8a; margin-top:4px;">v<span id="app-version"></span></div>
      </div>
    </div>

    <!-- MONKEYDEX MODAL -->
    <div id="monkeydex-modal">
      <div id="monkeydex-popup">
        <div class="dex-header">
          <span>🔬 Monkeydex — Variants &amp; Mastery</span>
          <button class="dex-close-btn" id="monkeydex-close">✕</button>
        </div>
        <div class="dex-note">Breed 10 of each color (5 of each gene) to unlock mastery buffs! ⭐</div>
        <div id="dex-body">
          <div id="dex-grid"></div>
          <div id="dex-milestones">
            <div class="ms-section-header">🏅 Milestones</div>
          </div>
        </div>
      </div>
    </div>

    <!-- MOVE MONKEY MODAL -->
    <div id="egs-gene-tooltip"><div id="egs-gene-tooltip-title"></div><div id="egs-gene-tooltip-body"></div></div>

    <!-- Shop modal -->
    <div id="shop-modal">
      <div id="shop-popup">
        <div id="shop-title">🛒 Shop</div>
        <div id="shop-balance">Balance: <span id="shop-balance-val">£0</span></div>
        <div id="shop-item-list"></div>
        <div id="shop-footer"><button class="btn" id="shop-close">Close</button></div>
      </div>
    </div>

    <div id="egg-storage-modal">
      <div id="egg-storage-popup">
        <div id="egg-storage-title">📦 Egg Storage</div>
        <input id="egs-search" type="text" placeholder="Search name, colour, genes, gender…" autocomplete="off">
        <div id="egg-storage-list"></div>
        <div id="egg-storage-footer">
          <button class="btn" id="egg-storage-close">Close</button>
        </div>
      </div>
    </div>

    <div id="move-monkey-modal">
      <div id="move-monkey-popup">
        <div id="move-monkey-title">Move to...</div>
        <div id="move-monkey-tanks"></div>
        <button class="btn" id="move-monkey-cancel">Cancel</button>
      </div>
    </div>

    <!-- SIDEBAR -->
    <div id="sidebar">

      <!-- Mini sidebar content (visible when collapsed) -->
      <div id="sidebar-mini-content">
        <div style="text-align:center;">
          <div id="mini-lv-label">LV</div>
          <div id="mini-lv-num">1</div>
        </div>
        <div id="mini-conditions"></div>
      </div>

      <!-- Player Level -->
      <div class="panel">
        <div class="panel-title">Player Level</div>
        <div id="tank-level-panel">
          <div id="tank-level-badge">
            <span>LV</span>
            <span id="tank-level-val">1</span>
          </div>
          <div id="tank-xp-wrap">
            <div id="tank-xp-track"><div id="tank-xp-bar" style="width:0%"></div></div>
            <div id="tank-xp-label">0 / 100 XP</div>
          </div>
        </div>
      </div>

      <!-- Tank conditions -->
      <div class="panel" id="conditions-panel">
        <div class="panel-title">Tank Conditions</div>
        <div id="tank-conditions-list"></div>
      </div>

      <!-- Actions -->
      <div class="panel" id="actions-panel">
        <div class="panel-title">Actions</div>
        <div style="display:flex; gap:4px;">
          <button class="btn" id="btn-aerate" disabled style="flex:1; font-size:10px; padding:4px 2px;">💨 Aerate</button>
          <button class="btn" id="btn-clean" disabled style="flex:1; font-size:10px; padding:4px 2px;">🧹 Clean</button>
          <button class="btn" id="btn-feed" disabled style="flex:1; font-size:10px; padding:4px 2px;">🍔 Feed</button>
        </div>
      </div>

      <!-- Inventory -->
      <div class="panel inv-collapsed" id="inventory-panel">
        <div class="panel-title" id="inv-panel-title">Inventory <button id="inv-collapse-btn">▴</button></div>
        <div class="inv-item" style="border-bottom: 1px solid #1a3a5c; margin-bottom: 4px; padding-bottom: 6px;">
          <span class="inv-icon">💷</span>
          <div class="inv-info">
            <span class="inv-name">Balance</span>
            <span class="inv-desc">Collect shed skins to earn money</span>
          </div>
          <span id="currency-balance" style="font-size:15px; font-weight:bold; color:#7fd8ff;">£0</span>
        </div>
        <div class="inv-item">
          <span class="inv-icon">🧪</span>
          <div class="inv-info">
            <span class="inv-name">Life Booster</span>
            <span class="inv-desc">+10 min to all adults</span>
          </div>
          <span class="inv-count" id="inv-life-booster-cnt">0</span>
          <button class="btn inv-use-btn" id="btn-use-life-booster" disabled>Use</button>
        </div>
        <div class="inv-item">
          <span class="inv-icon">🥚</span>
          <div class="inv-info">
            <span class="inv-name">Booster Egg Pack</span>
            <span class="inv-desc">Adds 5–8 new eggs</span>
          </div>
          <span class="inv-count" id="inv-egg-pack-cnt">0</span>
          <button class="btn inv-use-btn" id="btn-use-egg-pack" disabled>Use</button>
        </div>
        <div class="inv-item">
          <span class="inv-icon">✨</span>
          <div class="inv-info">
            <span class="inv-name">Glowing Flakes <span id="glowing-flakes-active-badge" style="display:none; color:#aa44ff; font-size:9px; font-weight:bold;">● ACTIVE</span></span>
            <span class="inv-desc">10× mutation for next birth (parents take damage)</span>
          </div>
          <span class="inv-count" id="inv-glowing-flakes-cnt">0</span>
          <button class="btn inv-use-btn" id="btn-use-glowing-flakes" disabled>Use</button>
        </div>
        <div class="inv-item">
          <span class="inv-icon">🔍</span>
          <div class="inv-info">
            <span class="inv-name">Magnifying Glass</span>
            <span class="inv-desc">Toggle to reveal full genotype in tooltips</span>
          </div>
          <span class="inv-count" id="inv-magnifying-glass-cnt">0</span>
          <button class="btn inv-use-btn" id="btn-toggle-magnifying-glass" disabled>🔍 Phenotype</button>
        </div>
        <div class="inv-item">
          <span class="inv-icon">🧪</span>
          <div class="inv-info">
            <span class="inv-name">Mutation Inhibitor <span id="mutation-inhibitor-badge" style="display:none; color:#44aaff; font-size:9px; font-weight:bold;"></span></span>
            <span class="inv-desc">Stops mutations in active tank for 10 min</span>
          </div>
          <span class="inv-count" id="inv-mutation-inhibitor-cnt">0</span>
          <button class="btn inv-use-btn" id="btn-use-mutation-inhibitor" disabled>Use</button>
        </div>
        <div class="inv-item" style="border-top: 1px solid #1a3a5c; margin-top: 4px; padding-top: 6px;">
          <span class="inv-icon">📦</span>
          <div class="inv-info">
            <span class="inv-name">Egg Storage</span>
            <span class="inv-desc">Stored eggs don't hatch or decay</span>
          </div>
          <span class="inv-count" id="inv-egg-storage-cnt">0</span>
          <button class="btn inv-use-btn" id="btn-view-egg-storage" disabled>View</button>
        </div>
        <div class="inv-item">
          <span class="inv-icon">🛒</span>
          <div class="inv-info">
            <span class="inv-name">Shop</span>
            <span class="inv-desc">Items, boosts &amp; upgrades</span>
          </div>
          <button class="btn inv-use-btn" id="btn-open-shop">Open</button>
        </div>
      </div>

      <!-- Debug timers (sidebar, shown when debug on) -->
      <div class="panel" id="debug-timers-panel" style="display:none;">
        <div class="panel-title">⏱ Active Timers</div>
        <div id="debug-timer-list"></div>
      </div>

      <!-- Event log -->
      <div class="panel" id="event-log-panel" style="flex:1; min-height:80px; flex-direction:column;">
        <div class="panel-title">Event Log</div>
        <div id="event-log" style="flex:1; overflow-y:auto;"></div>
      </div>

    </div>

    <!-- TANK -->
    <div id="tank">
      <div id="tank-gravel"></div>
      <div id="plant-layer">
        <!-- Far left: tall seaweed cluster -->
        <div class="sw" style="left:2%;   width:7px;  height:95px;  background:linear-gradient(to top,#0a3d18,#1c8038); animation:sway-l 3.4s ease-in-out infinite; animation-delay:0s;"></div>
        <div class="sw" style="left:3.5%; width:5px;  height:120px; background:linear-gradient(to top,#0a3d18,#22944a); animation:sway-r 4.1s ease-in-out infinite; animation-delay:-1.6s;"></div>
        <div class="sw" style="left:5%;   width:8px;  height:70px;  background:linear-gradient(to top,#0a3d18,#178034); animation:sway-l 2.9s ease-in-out infinite; animation-delay:-0.8s;"></div>
        <!-- Left-center: broad leaf plant -->
        <div class="pl" style="left:19%;  width:22px; height:58px;  background:linear-gradient(155deg,#0b5225,#1a8a42); transform:rotate(-22deg); animation:sway-s 3.8s ease-in-out infinite; animation-delay:-2.1s;"></div>
        <div class="pl" style="left:20%;  width:17px; height:46px;  background:linear-gradient(205deg,#0b5225,#228844); transform:rotate(16deg);  animation:sway-s 3.3s ease-in-out infinite; animation-delay:-0.4s;"></div>
        <div class="sw" style="left:21%;  width:5px;  height:62px;  background:linear-gradient(to top,#0a3d18,#1a7a34); animation:sway-r 3.6s ease-in-out infinite; animation-delay:-1.1s;"></div>
        <!-- Center: sparse seaweed -->
        <div class="sw" style="left:46%;  width:6px;  height:105px; background:linear-gradient(to top,#0a3d18,#1a7a34); animation:sway-l 4.3s ease-in-out infinite; animation-delay:-2.5s;"></div>
        <div class="sw" style="left:48%;  width:9px;  height:78px;  background:linear-gradient(to top,#0a3d18,#22904a); animation:sway-r 3.1s ease-in-out infinite; animation-delay:-0.6s;"></div>
        <!-- Right-center: broad leaf plant -->
        <div class="pl" style="left:67%;  width:24px; height:62px;  background:linear-gradient(155deg,#0b5225,#1a8a42); transform:rotate(-18deg); animation:sway-s 3.5s ease-in-out infinite; animation-delay:-1.9s;"></div>
        <div class="pl" style="left:68.5%;width:19px; height:50px;  background:linear-gradient(205deg,#0b5225,#228844); transform:rotate(22deg);  animation:sway-s 3.0s ease-in-out infinite; animation-delay:-0.2s;"></div>
        <!-- Far right: tall seaweed cluster -->
        <div class="sw" style="left:86%;  width:8px;  height:88px;  background:linear-gradient(to top,#0a3d18,#1c8038); animation:sway-r 3.2s ease-in-out infinite; animation-delay:-2.2s;"></div>
        <div class="sw" style="left:88%;  width:6px;  height:115px; background:linear-gradient(to top,#0a3d18,#22944a); animation:sway-l 4.0s ease-in-out infinite; animation-delay:-0.9s;"></div>
        <div class="sw" style="left:90%;  width:10px; height:68px;  background:linear-gradient(to top,#0a3d18,#178034); animation:sway-r 2.7s ease-in-out infinite; animation-delay:-1.4s;"></div>

        <!-- 11-14%: hairgrass cluster — thin bright blades, fast sway -->
        <div class="hg" style="left:11%;   width:2px; height:52px; background:linear-gradient(to top,#083018,#3dbb5a); animation:sway-fast 1.9s ease-in-out infinite; animation-delay:0s;"></div>
        <div class="hg" style="left:11.5%; width:3px; height:38px; background:linear-gradient(to top,#083018,#44cc66); animation:sway-fast 1.6s ease-in-out infinite; animation-delay:-0.2s;"></div>
        <div class="hg" style="left:12%;   width:2px; height:63px; background:linear-gradient(to top,#083018,#35aa50); animation:sway-fast 2.2s ease-in-out infinite; animation-delay:-0.5s;"></div>
        <div class="hg" style="left:12.5%; width:2px; height:44px; background:linear-gradient(to top,#083018,#40bb5e); animation:sway-fast 1.7s ease-in-out infinite; animation-delay:-0.8s;"></div>
        <div class="hg" style="left:13%;   width:3px; height:57px; background:linear-gradient(to top,#083018,#3ab855); animation:sway-fast 2.0s ease-in-out infinite; animation-delay:-0.4s;"></div>
        <div class="hg" style="left:13.5%; width:2px; height:40px; background:linear-gradient(to top,#083018,#44cc66); animation:sway-fast 1.8s ease-in-out infinite; animation-delay:-1.1s;"></div>

        <!-- 31-34%: tall teal seaweed -->
        <div class="sw" style="left:31%;  width:5px; height:160px; background:linear-gradient(to top,#0a3a30,#1a9a7a); animation:sway-l 4.5s ease-in-out infinite; animation-delay:-1.3s;"></div>
        <div class="sw" style="left:33%;  width:7px; height:135px; background:linear-gradient(to top,#0a3a30,#22aa88); animation:sway-r 3.8s ease-in-out infinite; animation-delay:-2.7s;"></div>
        <div class="sw" style="left:35%;  width:4px; height:112px; background:linear-gradient(to top,#0a3a30,#188070); animation:sway-l 4.1s ease-in-out infinite; animation-delay:-0.5s;"></div>

        <!-- 55-58%: fern-style plant -->
        <div class="fern" style="left:55%;  width:28px; height:65px; background:linear-gradient(145deg,#0a4020,#1a7840); transform:rotate(-25deg); animation:sway-s 3.7s ease-in-out infinite; animation-delay:-1.5s;"></div>
        <div class="fern" style="left:56%;  width:22px; height:52px; background:linear-gradient(195deg,#0a4020,#208842); transform:rotate(18deg);  animation:sway-s 3.2s ease-in-out infinite; animation-delay:-0.7s;"></div>
        <div class="fern" style="left:57%;  width:16px; height:40px; background:linear-gradient(165deg,#0a4020,#1a7038); transform:rotate(-10deg); animation:sway-s 2.9s ease-in-out infinite; animation-delay:-2.2s;"></div>

        <!-- 73-76%: burgundy/red aquatic plant — colour variety -->
        <div class="sw" style="left:73%;  width:6px;  height:148px; background:linear-gradient(to top,#2a0a18,#7a2850); animation:sway-r 4.2s ease-in-out infinite; animation-delay:-1.8s;"></div>
        <div class="pl" style="left:74%;  width:20px; height:55px;  background:linear-gradient(155deg,#2a0a18,#6a2040); transform:rotate(-20deg); animation:sway-s 3.6s ease-in-out infinite; animation-delay:-0.6s;"></div>
        <div class="pl" style="left:75%;  width:16px; height:44px;  background:linear-gradient(205deg,#2a0a18,#7a2850); transform:rotate(15deg);  animation:sway-s 3.1s ease-in-out infinite; animation-delay:-1.4s;"></div>
        <div class="sw" style="left:76%;  width:4px;  height:105px; background:linear-gradient(to top,#2a0a18,#5a1e38); animation:sway-l 3.9s ease-in-out infinite; animation-delay:-3.0s;"></div>

        <!-- 60%: lone tall centerpiece seaweed -->
        <div class="sw" style="left:60%;  width:4px;  height:178px; background:linear-gradient(to top,#0a3d18,#1a7a34); animation:sway-l 5.2s ease-in-out infinite; animation-delay:-3.1s;"></div>
      </div>
      <div id="tank-selector-bar"></div>
      <div id="tank-tab-bar">
        <button class="tank-tab active" id="tab-tank">🌊 Tank</button>
        <button class="tank-tab" id="tab-life-support">⚙️ Life Support</button>
        <button class="tank-tab" id="tab-population">🦐 Population</button>
      </div>
      <!-- hidden anchor so switchTankTab can toggle active class on it -->
      <button id="tab-tank-manager" style="display:none"></button>
      <div id="tank-manager-view">
        <div id="tank-manager-title">🏠 Tank Manager</div>
        <div id="tank-manager-list"></div>
      </div>
      <div id="life-support-view">
        <div id="life-support-view-title">⏳ Temporary Addons</div>
        <div id="life-support-content"></div>
      </div>
      <div id="population-view">
        <div id="population-view-title">📋 Population</div>
        <div id="pop-controls">
          <input id="pop-search" type="text" placeholder="Search name, colour, genes, gender…" autocomplete="off">
          <div id="pop-stage-filters">
            <label class="pop-filter-label"><input type="checkbox" id="pop-filter-egg"      checked> 🥚 Eggs</label>
            <label class="pop-filter-label"><input type="checkbox" id="pop-filter-baby"     checked> 🐠 Babies</label>
            <label class="pop-filter-label"><input type="checkbox" id="pop-filter-juvenile" checked> 🐟 Juveniles</label>
            <label class="pop-filter-label"><input type="checkbox" id="pop-filter-adult"    checked> 🦐 Adults</label>
            <label class="pop-filter-label"><input type="checkbox" id="pop-filter-dead"     checked> 💀 Dead</label>
          </div>
        </div>
        <div id="population-list"></div>
      </div>
      <div id="tank-overlay">
        <div id="overlay-emoji">🌊</div>
        <h2>Your Tank is Empty</h2>
        <p>Add a water packet to begin purification, then release your sea monkey eggs!</p>
        <div id="purify-countdown" style="display:none; color:#7fd8ff; font-size:13px;"></div>
        <div id="purify-progress" style="display:none; width:220px; height:6px; background:#0a1628; border-radius:3px; border:1px solid #1a3a5c; overflow:hidden;">
          <div id="purify-bar" style="width:0%; height:100%; background:linear-gradient(90deg,#0055cc,#44aaff); border-radius:3px; transition:width 0.5s;"></div>
        </div>
        <button class="big-btn" id="overlay-btn-water">💧 Add Water Packet</button>
      </div>
      <div id="monkey-container"></div>
      <div id="fps-cap-banner" style="display:none; position:absolute; top:8px; left:50%; transform:translateX(-50%); z-index:10; background:rgba(10,22,40,0.82); border:1px solid #aa5500; border-radius:6px; padding:4px 12px; font-size:10px; color:#ffaa44; white-space:nowrap; pointer-events:none;">⚠️ Overpopulation hidden due to FPS cap</div>
      <div id="notifications"></div>
    </div>

    <!-- STATUS BAR -->
    <div id="statusbar">
      <span id="status-msg">Waiting for water...</span>
    </div>

    <script src="./renderer.js"></script>
  </body>
</html>
